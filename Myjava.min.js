document.addEventListener('DOMContentLoaded', function() {
    // Function to handle the safe link click event
    const safeLinks = document.querySelectorAll('.safe-link'); // Assuming links have the 'safe-link' class
    
    safeLinks.forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default link behavior
            
            // Step 1: Redirect to the homepage for verification
            window.location.href = '/';  // Adjust if your homepage URL is different
            
            // Step 2: Once the homepage loads, redirect to the actual target post after a short delay
            setTimeout(function() {
                window.location.href = link.getAttribute('href');  // Use the href of the clicked link
            }, 3000);  // Adjust the delay (in milliseconds) as necessary

            // Optional: Display embed code after redirecting to the post
            displayEmbedCode(link.getAttribute('href'));
        });
    });

    // Function to display the embed code from the destination page
    function displayEmbedCode(url) {
        // Here you can fetch the embed code from the destination page using AJAX or an API
        // Assuming the destination page allows embedding:
        
        fetch(url)
            .then(response => response.text())
            .then(data => {
                const embedCode = extractEmbedCode(data);  // You'd need to create this function to extract the embed code from the page content
                
                // Insert the embed code into a container on the homepage
                document.querySelector('.embed-container').innerHTML = embedCode;
            })
            .catch(error => {
                console.error('Error fetching embed code:', error);
            });
    }

    // Example function to extract embed code from the page (adjust as needed)
    function extractEmbedCode(pageContent) {
        // Here, you'd extract the relevant embed code based on your page's structure
        // For example, it could be within an iframe or a specific div
        const embedMatch = pageContent.match(/<iframe.*?src="(.*?)".*?>/);
        if (embedMatch) {
            return `<iframe src="${embedMatch[1]}" frameborder="0"></iframe>`;
        }
        return 'No embed code found.';
    }
});
