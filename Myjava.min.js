// Function to decrypt the safelink
function decryptSafeLink(encryptedData) {
    var key = "your-secret-key"; // Make sure this key is the same as used for encryption
    try {
        return aesCrypto.decrypt(decodeURIComponent(encryptedData), key);
    } catch (error) {
        console.error("Decryption failed:", error);
        return null;
    }
}

// Automatically process the safelink on page load
window.onload = function() {
    var pathParts = window.location.pathname.split("/safelink/");
    if (pathParts.length > 1) {
        var encryptedData = pathParts[1]; // Extract encrypted URL from the path
        var originalUrl = decryptSafeLink(encryptedData);

        if (originalUrl) {
            console.log("Redirecting to:", originalUrl);
            window.location.href = originalUrl; // Redirect to the original link
        } else {
            console.error("Invalid safelink data. Redirecting to homepage.");
            window.location.href = "/"; // Redirect to home if decryption fails
        }
    }
};
